# 확산도 가중치 시스템 구현 완료 보고서

**구현 일시**: 2026-01-13  
**적용 옵션**: A (보수적 접근)

---

## 📌 구현 개요

중복 뉴스를 제거 대상이 아닌 **"시장 관심도(확산도)"** 지표로 활용하여, 투자 분석의 정확도를 높이는 시스템을 구현했습니다.

---

## ✅ 구현 완료 항목

### 1. 데이터베이스 스키마 업데이트
- **새 컬럼 추가**: `duplicate_count INTEGER DEFAULT 1`
- **마이그레이션**: 기존 데이터 자동 업데이트 (모두 1로 설정)
- **위치**: `news_scraper/database.py`

### 2. 중복 처리 로직 변경
**변경 전 (기존)**:
```python
except sqlite3.IntegrityError:
    logger.debug(f"중복 뉴스 건너뜀: {news_id}")
    return False
```

**변경 후 (신규)**:
```python
cursor.execute("SELECT id, duplicate_count FROM news WHERE news_id = ?", (news_id,))
existing = cursor.fetchone()

if existing:
    # 중복 발견 시 카운트 증가
    new_count = existing[1] + 1
    cursor.execute("UPDATE news SET duplicate_count = ? WHERE news_id = ?", 
                  (new_count, news_id))
```

### 3. 확산도 가중치 함수 구현

**옵션 A (보수적 접근) 채택**:
```python
def calculate_spread_weight(duplicate_count):
    if duplicate_count >= 6:
        return 1.30  # +30%
    elif duplicate_count >= 4:
        return 1.20  # +20%
    elif duplicate_count >= 2:
        return 1.10  # +10%
    else:
        return 1.0   # 기본
```

**가중치 표**:
| 중복 횟수 | 가중치 | 가산점 | 효과 |
|---------|--------|--------|------|
| 1회 | 1.0 | - | 기본 |
| 2-3회 | 1.1 | +10% | 보통 화제 |
| 4-5회 | 1.2 | +20% | 높은 화제 |
| 6회+ | 1.3 | +30% | 최고 화제 (상한선) |

### 4. 종목 분석 점수 계산 개선

**기존 (v1)**:
```
composite_score = (평균감성 × 0.4) + (평균종합 × 0.4) + (뉴스개수 × 0.2)
```

**신규 (v2)**:
```
composite_score = (평균감성 × 0.3) + (평균종합 × 0.3) + 
                  (뉴스개수 × 0.2) + (확산도 × 0.2)
```

**차이점**:
- 감성/종합 비중 감소: 40% → 30%
- 새로운 요소 추가: 확산도 20%
- 더 균형잡힌 분석 가능

### 5. 새로운 분석 항목 추가

#### A. 고확산 종목 TOP 10
시장에서 가장 화제가 되는 종목 표시
```
[5] 고확산 종목 TOP 10 (시장 화제)
순위   종목코드    총확산도    뉴스수    평균확산   감성
1      005380     146        146       1.00      0.129
2      005930     125        125       1.00      0.182
```

#### B. 확산도 정보 표시
각 뉴스에 확산 횟수 태그 추가: `[확산x5]`

---

## 🔄 시스템 동작 방식

### 시나리오 예시

**1단계: 첫 수집**
```
"삼성전자, AI 반도체 신제품 공개" (네이버)
→ news_id: naver_samsung_ai_001
→ duplicate_count = 1
→ 가중치 = 1.0
```

**2단계: 중복 감지**
```
"삼성전자, AI 반도체 신제품 공개" (한경)
→ 같은 news_id 감지
→ duplicate_count = 2
→ 가중치 = 1.1 (+10%)
```

**3단계: 추가 확산**
```
"삼성전자, AI 반도체 신제품 공개" (매경)
→ duplicate_count = 3
→ 가중치 = 1.1 (+10%)

"삼성전자, AI 반도체 신제품 공개" (DART)
→ duplicate_count = 4
→ 가중치 = 1.2 (+20%)
```

**4단계: 종목 점수 계산**
```
원래 감성 점수: 0.5
확산도 적용 후: 0.5 × 1.2 = 0.6 (+20% 상승!)

→ 매수 후보 순위 상승
→ 투자자 관심 반영
```

---

## 📊 실제 적용 효과 (예상)

### Before (기존 시스템)
```
종목: 005930 (삼성전자)
뉴스: 5개
평균 감성: 0.3
종합 점수: 0.45
순위: 15위
```

### After (확산도 적용)
```
종목: 005930 (삼성전자)
뉴스: 5개 (중복 총 15회)
평균 감성: 0.3 × 1.2 = 0.36 (+20%)
평균 확산: 1.2
종합 점수: 0.52 (+15.6%)
순위: 8위 ↑↑
```

---

## 🎯 투자 실전 활용

### 1. 시장 화제성 파악
- 확산도 높음 = 많은 매체가 주목
- 투자자 관심도 증가 예상
- 단기 모멘텀 포착 가능

### 2. 노이즈 필터링
- 확산도 낮음 = 일회성 뉴스
- 신뢰도 낮은 정보 구분
- 과잉 반응 방지

### 3. 리스크 관리
- 부정 뉴스 확산 = 위험 신호 강화
- 긍정 뉴스 확산 = 기회 신호 강화
- 더 명확한 투자 판단

---

## 📁 업데이트된 파일 목록

1. **news_scraper/database.py**
   - `duplicate_count` 컬럼 추가
   - 중복 처리 로직 수정
   - 마이그레이션 코드 추가

2. **analyze_today_stocks.py** (메인)
   - v2로 교체 완료
   - 확산도 가중치 적용
   - 새로운 분석 항목 추가

3. **analyze_today_stocks_v1_backup.py**
   - 기존 버전 백업
   - 필요시 롤백 가능

4. **analyze_today_stocks_v2.py**
   - v2 개발 버전 (참고용)

---

## 🔧 사용 방법

### 종목 분석 실행
```bash
python analyze_today_stocks.py
```

### 일일 보고서 실행
```bash
python daily_report_20260113.py
```

### 문제점 점검
```bash
python check_issues.py
```

---

## 📈 향후 개선 가능사항

### 1. 확산도 가중치 최적화
- 백테스트를 통한 최적 비율 찾기
- 출처별 차별화 (주요 언론사 가중치 높게)
- 시간대별 차별화 (속보성 반영)

### 2. 확산 패턴 분석
- 급확산 뉴스 = 급등/급락 신호
- 점진적 확산 = 안정적 트렌드
- 확산 속도를 추가 지표로 활용

### 3. 출처별 신뢰도
```python
출처 가중치 = {
    'dart': 1.5,           # 공시는 높은 신뢰도
    'naver_finance': 1.2,  # 주요 금융뉴스
    'hankyung': 1.0,       # 기본
    'mk_news': 0.8,        # 상대적으로 낮게
}
```

### 4. 시간 감쇠 적용
- 최신 뉴스 확산: 높은 가중치
- 오래된 뉴스 확산: 낮은 가중치
- 실시간성 강화

---

## ⚠️ 주의사항

1. **기존 데이터**
   - 모든 기존 뉴스는 `duplicate_count = 1`
   - 확산도 효과는 새로 수집되는 뉴스부터 적용

2. **중복 판단 기준**
   - 현재: `news_id` 기준 (URL + 제목 해시)
   - 완전히 동일한 뉴스만 중복으로 판단
   - 유사 뉴스는 별도 처리 필요

3. **DART 공시 중복**
   - 자산운용사별 동일 공시가 대량 발생 가능
   - 필요시 DART 공시는 확산도 가중치 낮게 조정

4. **투자 참고사항**
   - 확산도는 보조 지표일 뿐
   - 기술적/기본적 분석 병행 필수
   - 리스크 관리 철저히

---

## 📊 구현 완료 요약

| 항목 | 상태 | 비고 |
|-----|------|------|
| 데이터베이스 스키마 | ✅ 완료 | duplicate_count 추가 |
| 중복 처리 로직 | ✅ 완료 | 카운트 증가 방식 |
| 확산도 가중치 함수 | ✅ 완료 | 옵션 A 적용 |
| 종목 분석 개선 | ✅ 완료 | 4가지 요소 균형 |
| 새 분석 항목 | ✅ 완료 | 고확산 종목 TOP 10 |
| 파일 업데이트 | ✅ 완료 | 메인 파일 교체 |
| 백업 생성 | ✅ 완료 | v1 백업 보관 |
| 문서화 | ✅ 완료 | 본 문서 |

---

## 🎉 구현 완료!

이제 NewsQuant 시스템은 단순히 뉴스를 수집하는 것을 넘어, **시장의 관심도(확산도)**를 측정하여 더 정확한 투자 신호를 제공합니다!

**실전 투자에 행운을 빕니다! 🚀📈**

---

**문의사항이나 개선 아이디어가 있으시면 언제든 말씀해주세요.**
